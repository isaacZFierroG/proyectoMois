import{f as L}from"./Grid-d8533d20.js";import{a8 as m,q as B,b8 as C,k as S,n as M,m as R,Z as V,X as T,W as H,v as E,F as O,a7 as U}from"./index-25a1633d.js";function P(e,u="default",r=void 0){const a=e[u];if(!a)return m("getFirstSlotVNode",`slot[${u}] is empty`),null;const o=L(a(r));return o.length===1?o[0]:(m("getFirstSlotVNode",`slot[${u}] should have exactly one child`),null)}function y(e){return typeof e=="string"?document.querySelector(e):e()}function w(e){return e instanceof HTMLElement}function I(e){for(let u=0;u<e.childNodes.length;u++){const r=e.childNodes[u];if(w(r)&&(p(r)||I(r)))return!0}return!1}function N(e){for(let u=e.childNodes.length-1;u>=0;u--){const r=e.childNodes[u];if(w(r)&&(p(r)||N(r)))return!0}return!1}function p(e){if(!_(e))return!1;try{e.focus({preventScroll:!0})}catch{}return document.activeElement===e}function _(e){if(e.tabIndex>0||e.tabIndex===0&&e.getAttribute("tabIndex")!==null)return!0;if(e.getAttribute("disabled"))return!1;switch(e.nodeName){case"A":return!!e.href&&e.rel!=="ignore";case"INPUT":return e.type!=="hidden"&&e.type!=="file";case"BUTTON":case"SELECT":case"TEXTAREA":return!0;default:return!1}}let s=[];const X=B({name:"FocusTrap",props:{disabled:Boolean,active:Boolean,autoFocus:{type:Boolean,default:!0},onEsc:Function,initialFocusTo:String,finalFocusTo:String,returnFocusOnDeactivated:{type:Boolean,default:!0}},setup(e){const u=C(),r=S(null),a=S(null);let o=!1,i=!1;const F=typeof document>"u"?null:document.activeElement;function c(){return s[s.length-1]===u}function v(t){var n;t.code==="Escape"&&c()&&((n=e.onEsc)===null||n===void 0||n.call(e,t))}M(()=>{R(()=>e.active,t=>{t?(x(),V("keydown",document,v)):(T("keydown",document,v),o&&g())},{immediate:!0})}),H(()=>{T("keydown",document,v),o&&g()});function b(t){if(!i&&c()){const n=h();if(n===null||n.contains(U(t)))return;l("first")}}function h(){const t=r.value;if(t===null)return null;let n=t;for(;n=n.nextSibling,!(n===null||n instanceof Element&&n.tagName==="DIV"););return n}function x(){var t;if(!e.disabled){if(s.push(u),e.autoFocus){const{initialFocusTo:n}=e;n===void 0?l("first"):(t=y(n))===null||t===void 0||t.focus({preventScroll:!0})}o=!0,document.addEventListener("focus",b,!0)}}function g(){var t;if(e.disabled||(document.removeEventListener("focus",b,!0),s=s.filter(f=>f!==u),c()))return;const{finalFocusTo:n}=e;n!==void 0?(t=y(n))===null||t===void 0||t.focus({preventScroll:!0}):e.returnFocusOnDeactivated&&F instanceof HTMLElement&&(i=!0,F.focus({preventScroll:!0}),i=!1)}function l(t){if(c()&&e.active){const n=r.value,f=a.value;if(n!==null&&f!==null){const d=h();if(d==null||d===f){i=!0,n.focus({preventScroll:!0}),i=!1;return}i=!0;const D=t==="first"?I(d):N(d);i=!1,D||(i=!0,n.focus({preventScroll:!0}),i=!1)}}}function A(t){if(i)return;const n=h();n!==null&&(t.relatedTarget!==null&&n.contains(t.relatedTarget)?l("last"):l("first"))}function k(t){i||(t.relatedTarget!==null&&t.relatedTarget===r.value?l("last"):l("first"))}return{focusableStartRef:r,focusableEndRef:a,focusableStyle:"position: absolute; height: 0; width: 0;",handleStartFocus:A,handleEndFocus:k}},render(){const{default:e}=this.$slots;if(e===void 0)return null;if(this.disabled)return e();const{active:u,focusableStyle:r}=this;return E(O,null,[E("div",{"aria-hidden":"true",tabindex:u?"0":"-1",ref:"focusableStartRef",style:r,onFocus:this.handleStartFocus}),e(),E("div",{"aria-hidden":"true",style:r,ref:"focusableEndRef",tabindex:u?"0":"-1",onFocus:this.handleEndFocus})])}});export{X as F,P as g};
